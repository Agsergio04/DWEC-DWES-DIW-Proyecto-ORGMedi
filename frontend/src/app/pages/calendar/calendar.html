<section class="page page--calendar">
  <div class="page__container">
    <header class="calendar__title-section">
      <h1>Calendario</h1>
      <p class="calendar__description">Aquí podrás gestionar cuando has consumido los medicamentos</p>
    </header>

    <app-calendar (daySelected)="onCalendarDaySelected($event)" aria-label="Calendario de medicamentos"></app-calendar>

    <main class="calendar__medicines-list" aria-label="Medicamentos del día seleccionado">
      <!-- Lista de medicamentos o mensaje vacío -->
      <div *ngIf="!loading() && medicineGroups.length > 0; else noMedicines" class="medicines__list" role="region">
        <!-- Mostrar grupos de medicamentos por hora -->
        <div *ngFor="let group of medicineGroups; trackBy: trackByTime" class="medicines__time-group">
          <!-- Hora como encabezado -->
          <div class="medicines__time-header">
            <time>{{ group.time }}</time>
          </div>
          
          <!-- Medicamentos en esta hora -->
          <div class="medicines__group-items">
            <app-medicine-card-calendar 
              *ngFor="let medicine of group.medicines; trackBy: trackById"
              [medicine]="medicine"
              [displayTime]="''"
              [isExpired]="isExpired(medicine)"
              [isExpiring]="isExpiring(medicine)"
              (medicineEdit)="editMedicine($event)"
              (medicineDelete)="deleteMedicine($event)"
              (medicineSelected)="onMedicineSelected($event.id, $event.instanceId)"
              [attr.aria-label]="'Medicamento: ' + medicine.nombre">
            </app-medicine-card-calendar>
          </div>
        </div>
      </div>

      <!-- Sin medicamentos -->
      <ng-template #noMedicines>
        <aside class="medicines__empty-message" role="status">
          <p>No se han creado medicamentos todavia</p>
        </aside>
      </ng-template>
    </main>
  </div>
</section>

