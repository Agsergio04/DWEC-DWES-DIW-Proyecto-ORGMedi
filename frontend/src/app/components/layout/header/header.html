<header class="app-header">
  <!-- IZQUIERDA: Logo + Título -->
  <div class="app-header__brand">
    <a class="app-header__logo" routerLink="/" aria-label="Inicio - ORGMedi">
      <img src="/Icono App.svg" alt="ORGMedi" class="app-header__svg-logo" aria-hidden="true" />
      <span class="app-header__title">ORGMedi</span>
    </a>
  </div>

  <!-- BREADCRUMBS -->
  <!-- <app-breadcrumb></app-breadcrumb> -->

  <!-- DERECHA: Hamburguesa + Tema -->
  <div class="app-header__controls">
    <!-- Botón hamburguesa (solo visible si está logueado) -->
    <button
      *ngIf="isLoggedIn"
      #menuButton
      class="app-header__hamburger"
      [class.is-open]="isOpen"
      (click)="toggleMenu()"
      aria-label="Menú principal"
      [attr.aria-expanded]="isOpen"
      aria-controls="main-nav-menu"
      [attr.aria-pressed]="isOpen"
    >
      <svg
        width="26"
        height="18"
        viewBox="0 0 26 18"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        focusable="false"
        aria-hidden="true"
      >
        <path
          d="M1 9H25M1 1H25M1 17H25"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>

    <!-- Botón de notificaciones -->
    <button
      class="app-header__notifications-btn"
      (click)="toggleNotificationsPanel()"
      aria-label="Ver notificaciones"
      [attr.aria-pressed]="showNotificationsPanel()"
      *ngIf="isLoggedIn"
    >
      <span class="app-header__notifications-icon" aria-hidden="true">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
        >
          <path
            d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <path
            d="M13.73 21a2 2 0 0 1-3.46 0"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </span>
      <!-- Badge de notificaciones no leídas -->
      <span
        class="app-header__notifications-badge"
        *ngIf="unreadCount() > 0"
        [attr.aria-label]="unreadCount() + ' notificaciones sin leer'"
      >
        {{ unreadCount() > 99 ? '99+' : unreadCount() }}
      </span>
    </button>

    <!-- Panel de notificaciones -->
    <dialog
      class="app-header__notifications-panel"
      [class.is-open]="showNotificationsPanel()"
      *ngIf="isLoggedIn"
      aria-label="Panel de notificaciones"
    >
      <header class="app-header__notifications-header">
        <h2 class="app-header__notifications-title">Notificaciones</h2>
        <button
          class="app-header__notifications-close"
          type="button"
          (click)="closeNotificationsPanel()"
          aria-label="Cerrar panel de notificaciones"
        >
          <span aria-hidden="true">✕</span>
        </button>
      </header>

      <main class="app-header__notifications-list">
        <ng-container *ngIf="notificationsList() && notificationsList().length > 0; else noNotifications">
          <article
            class="app-header__notification-item"
            *ngFor="let notification of notificationsList()"
            [class.is-unread]="!notification.read"
            role="region"
            [attr.aria-label]="'Notificación: ' + notification.message"
          >
            <div class="app-header__notification-content">
              <p class="app-header__notification-message">{{ notification.message }}</p>
              <time class="app-header__notification-time" [dateTime]="notification.createdAt">
                {{ notification.createdAt | date: 'short' }}
              </time>
            </div>
            <div class="app-header__notification-actions" role="toolbar" aria-label="Acciones de notificación">
              <button
                class="app-header__notification-action"
                type="button"
                (click)="markNotificationAsRead(notification.id, $event)"
                [title]="notification.read ? 'Marcar como no leído' : 'Marcar como leído'"
                [attr.aria-label]="'Marcar como ' + (!notification.read ? 'leído' : 'no leído') + ': ' + notification.message"
              >
                <span aria-hidden="true">
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    focusable="false"
                  >
                    <path
                      d="M20 6L9 17l-5-5"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </span>
              </button>
              <button
                class="app-header__notification-action app-header__notification-delete"
                type="button"
                (click)="deleteNotification(notification.id, $event)"
                [attr.aria-label]="'Eliminar notificación: ' + notification.message"
              >
                <span aria-hidden="true">
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    focusable="false"
                  >
                    <path
                      d="M18 6L6 18M6 6l12 12"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </span>
              </button>
            </div>
          </article>
        </ng-container>

        <ng-template #noNotifications>
          <section class="app-header__notifications-empty" role="status">
            <p>No hay notificaciones</p>
          </section>
        </ng-template>
      </main>
    </dialog>

    <!-- Botón de tema -->
    <button
      class="app-header__theme-toggle"
      (click)="toggleTheme()"
      aria-label="Cambiar tema"
      [attr.aria-pressed]="isDarkMode"
    >
      <ng-container *ngIf="isDarkMode; else lightIcon">
        <!-- SVG modo oscuro -->
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          aria-hidden="true"
        >
          <path
            d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </ng-container>
      <ng-template #lightIcon>
        <!-- SVG modo claro -->
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          focusable="false"
          aria-hidden="true"
        >
          <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </ng-template>
    </button>
  </div>

  <!-- Overlay para cerrar el menú al hacer clic fuera -->
  <div
    class="app-header__overlay"
    (click)="closeMenu()"
    [class.is-visible]="isOpen"
    aria-hidden="true"
  ></div>

  <!-- Menú desplegable (sidebar) -->
  <nav
    #navMenu
    id="main-nav-menu"
    class="app-header__nav"
    [class.is-open]="isOpen"
    [attr.aria-hidden]="!isOpen"
    role="navigation"
    aria-label="Navegación principal"
  >
    <ng-container *ngIf="!isAuthRoute">
      <!-- Calendario -->
      <a
        class="app-header__menu-item"
        routerLink="/calendario"
        routerLinkActive="is-active"
        [attr.aria-current]="router.isActive('calendario', true) ? 'page' : null"
        aria-label="Ver calendario"
        (click)="closeMenu()"
      >
        <span class="app-header__menu-icon" aria-hidden="true">
          <svg
            width="24"
            height="24"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M8 4H28C29.1046 4 30 4.89543 30 6V28C30 29.1046 29.1046 30 28 30H8C6.89543 30 6 29.1046 6 28V6C6 4.89543 6.89543 4 8 4Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M12 2V8M24 2V8M6 12H30"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </span>
        <span class="app-header__menu-label">Calendario</span>
      </a>

      <!-- Perfil -->
      <a
        class="app-header__menu-item"
        routerLink="/perfil"
        routerLinkActive="is-active"
        [attr.aria-current]="router.isActive('perfil', true) ? 'page' : null"
        aria-label="Ir al perfil"
        (click)="closeMenu()"
      >
        <span class="app-header__menu-icon" aria-hidden="true">
          <svg
            width="24"
            height="24"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M22.5714 13.5556C22.5714 14.4985 22.0898 15.4029 21.2325 16.0697C20.3752 16.7365 19.2124 17.1111 18 17.1111C16.7876 17.1111 15.6248 16.7365 14.7675 16.0697C13.9102 15.4029 13.4286 14.4985 13.4286 13.5556C13.4286 12.6126 13.9102 11.7082 14.7675 11.0414C15.6248 10.3746 16.7876 10 18 10C19.2124 10 20.3752 10.3746 21.2325 11.0414C22.0898 11.7082 22.5714 12.6126 22.5714 13.5556ZM18 19.7778C15.8783 19.7778 13.8434 20.4333 12.3431 21.6002C10.8429 22.7671 10 24.3498 10 26H26C26 24.3498 25.1571 22.7671 23.6569 21.6002C22.1566 20.4333 20.1217 19.7778 18 19.7778Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </span>
        <span class="app-header__menu-label">Perfil</span>
      </a>

      <!-- Medicamento/Pastillas -->
      <a
        class="app-header__menu-item"
        routerLink="/medicamentos"
        routerLinkActive="is-active"
        [attr.aria-current]="router.isActive('medicamentos', true) ? 'page' : null"
        aria-label="Ver medicamentos"
        (click)="closeMenu()"
      >
        <span class="app-header__menu-icon" aria-hidden="true">
          <svg
            width="24"
            height="24"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M11.1716 11.3726C10.8001 11.8078 10.5055 12.3244 10.3045 12.8929C10.1035 13.4615 10 14.0709 10 14.6863C10 15.3017 10.1035 15.9111 10.3045 16.4797C10.5055 17.0482 10.8001 17.5649 11.1716 18L18 26L24.8284 18C25.5786 17.1212 26 15.9292 26 14.6863C26 13.4434 25.5786 12.2514 24.8284 11.3726C24.0783 10.4937 23.0609 10 22 10C20.9391 10 19.9217 10.4937 19.1716 11.3726L18 12.7452L16.8285 11.3726C16.457 10.9374 16.0161 10.5922 15.5308 10.3567C15.0455 10.1212 14.5253 10 14 10C13.4747 10 12.9546 10.1212 12.4693 10.3567C11.984 10.5922 11.543 10.9374 11.1716 11.3726Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </span>
        <span class="app-header__menu-label">Medicamentos</span>
      </a>
    </ng-container>
  </nav>

  <!-- Toast global -->
  <app-toast></app-toast>
</header>
